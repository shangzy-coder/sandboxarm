# 通用规范

除非特殊说明，沙盒的所有代码都在 `/tmp` 下面现场创建的临时目录内执行，在代码执行结束后，这个目录会被销毁。

除非特殊说明，沙盒传入的 code 参数会被写入到临时目录下的一个临时文件中，以 Python 为例，启动指令会形如 `python /tmp/tmpha4dcl5b/tmpx8k1pnfh.py` 。

通过 `files` 传入的文件，支持绝对路径或相对路径，相对路径是基于上述临时目录的，如 `/tmp/tmpha4dcl5b` 。

`fetch_files` 参数的文件路径规则于 `files` 相同，具体传入方式参考 [API文档](/docs/api/run-code-run-code-post) 。

在执行代码时，沙盒提供了两种不同的隔离模式，配置方法可以参考 [这里](/docs/docs/reference/config) 。

一个较为通用的代码执行流程：

1. 创建临时目录
2. 写入 `files` 传入的文件
3. 写入 `code` 传入的代码到临时文件
4. 根据隔离模式设置环境
5. 执行编译命令(如果需要)
6. 执行运行命令
7. 获取 `fetch_files` 指定的文件
8. 清理环境

## 隔离模式

### 无隔离

该模式不对执行代码的进程做任何限制，不过对部分语言会将进程的 uid 设置为非 root 的。 这种模式的性能最好。

### 轻量隔离

轻量隔离的性能相对弱一些，而且需要特权容器才能使用。 适用于被执行的代码较为危险、或是需要修改系统文件的情况。 隔离的内容包括：

- cgroups 资源限制 (CPU、内存)
- 网络命名空间隔离
- overlayfs + chroot 文件系统隔离
- PID 命名空间隔离
